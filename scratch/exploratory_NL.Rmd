---
title: "exploratory_cd_time"
author: "Nicholas Lesniak"
date: "2/2/2017"
output: html_document
---

```{r setup environment, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

pack_used <- c('tidyr','dplyr','ggplot2')
for (dep in pack_used){
  if (dep %in% installed.packages()[,"Package"] == FALSE){
    install.packages(as.character(dep), repos = 'http://cran.us.r-project.org', 
                     quiet=TRUE);
  }
  library(dep, verbose=FALSE, character.only=TRUE)
}

meta_file   <- '../data/raw/abx_cdiff_metadata.tsv'
shared_file <- '../data/mothur/abx_time.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.pick.an.unique_list.0.03.subsample.shared'
tax_file <- '../data/mothur/abx_time.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.pick.an.unique_list.0.03.cons.taxonomy'
tax_function <- '~/Documents/Github/Personal/functions/taxa_labels.R'

meta_file   <- read.table(meta_file, sep = '\t', header = T)
shared_file <- read.table(shared_file, sep = '\t', header = T)
tax_file <- read.table(tax_file, sep = '\t', header = T)
source(tax_function)



```

```{r }
meta_file$dose <- as.character(meta_file$dose)
meta_file$dose[meta_file$dose == '10mg/kg'] <- 10
meta_file$dose <- as.numeric(meta_file$dose)

meta_file$abx[meta_file$abx == 'vanc '] <- 'vanc'

meta_file %>% 
  filter(day >= 0) %>%
  ggplot(aes(x = day, y = CFU +1, color = dose)) + 
        scale_y_log10() + 
        scale_colour_gradient(limits=c(0, 10)) + 
        facet_grid(abx ~., scales = 'free_y') + 
        geom_jitter(width = 0.3, alpha = 0.2) + 
    #    scale_color_manual(values = c('black', 'red'), breaks=c("FALSE", "TRUE"),
    #                       labels=c("Persistent", "Severe")) +
        stat_summary(fun.y=median, geom="line", aes(group = cage)) +
        labs(x = 'Day', y = ' CFU (log10)', title = 'C. Difficile Colonization') +
        theme(legend.justification=c(1,0), legend.position=c(1,0.2), 
                  legend.title=element_blank()) +
        stat_summary(fun.data = 'median_hilow', fun.args = (conf.int=0.5)) + 
        theme_bw() +
        theme(legend.justification=c(1,0), legend.position=c(1,0.2), 
              legend.title=element_blank())


```


```{r, test, eval = F}
df <- data.frame(pred = sample(1:100, 200, replace = T),
                            group = rep(c('a','b'), 100),
                            discrete_variable = sample(letters, 200, replace = T))


#filter(prediction_df, sample == 'a') %>% 
ggplot(data.frame(prediction_df), aes(x=predA)) + 
  stat_count(aes(y = ..count../sum(..count..), fill = sample), position = 'dodge')+
#    stat_count(aes(y = ..count../sum(..count..))) +
    labs(x = 'Predicted Value', y = 'Fraction of Samples') + 
    theme_bw()

df %>% 
  group_by(group, discrete_variable) %>% 
  summarise(count = n()) %>% 
  mutate(proportion = count/sum(count)) %>% 
  ggplot(aes(x = discrete_variable, y = proportion,fill=group))+
  geom_bar(stat="identity",position='dodge')

```
